\section{Systembeschreibung} % (fold)
\label{sec:system}

\subsection{Etherpad Lite}
\label{sub:system:etherpad}

\textit{Etherpad Lite}\citeque{etherpad} ist ein kollaborativer Online-Editor.
Anwender können Textdokumente, sogenannte Pads, gemeinschaftlich und in Echtzeit online bearbeiten.
Die Oberfläche ist browserbasiert.
Innerhalb der Pads ist durch farbliche Markierung gekennzeichnet, welche Bearbeitungen von welchem Nutzer vorgenommen wurden.
Eine Instanz des Etherpad Lite ist standardmäßig offen.
Damit kann jeder Anwender Pads anlegen und bearbeiten.
Das System speichert Revisionen des Pad-Inhalts, die später abgerufen werden können.
Die Oberfläche bietet außerdem die Möglichkeit zum Export des Inhalts in verschiedene Dokumentformate sowie einen Onlinechat zur Verständigung unter den Autoren.\\
Das Projekt ist Open-Source und damit quelloffen und frei für jeden.

\subsection{Abgrenzung und Zielstellung}
Die Oberfläche des Etherpad Lite ist schlicht und übersichtlich gehalten.
Sie bietet benutzerrelevante Funktionen, die sich auf ein einzelnes Pad beziehen.
Administrative Funktionen, die bestimmten Benutzerkreisen vorbehalten bleiben müssen, sind auf der Oberfläche nicht implementiert.
Es gibt somit keine Möglichkeit, z.B. alle verfügbaren Pads anzuzeigen oder einzelne Pads zu löschen.\\
Es existiert eine umfangreiche HTTP-API, über die diverse Funktionen verfügbar gemacht werden.
Für die praktische Verwendung dieser API ist ein Frontend sinnvoll.\\
Das Projekt EtherApp hat zum Ziel, einen Teil der API-Funktionen abzubilden und eine App zur Administration verschiedener Etherpad-Lite-Instanzen zu entwickeln.
Das beinhaltet insbesondere folgende Funktionen:

\begin{itemize}
	\item Anzeige aller Pads
	\item Anzeige von Meta-Informationen für einzelne Pads (Benutzer online, Revisionen, Datum, …)
	\item Anlegen neuer Pads
	\item Löschen von Pads
	\item Anzeige des Pad-Inhalts
	\item Teilen der Pad-URL über soziale Dienste und E-Mail
	\item Rücksetzen des Inhalts auf ältere Revision
	\item Anzeige und Verwaltung von Gruppen
	\item Verwaltung mehrerer EPL-Instanzen und Profilverwaltung
\end{itemize}

% section system (end)

\section{Vorgehen} % (fold)

\subsection{Zugriff auf die HTTP-API}
Das EPL bietet von Haus aus eine umfangreiche HTTP-API\citeque{epl-httpapi}.
Sie stellt eine Reihe von Funktionen für administrative Aufgaben bereit, die über die offene Weboberfläche nicht zur Verfügung stehen.
Der Zugriff auf die API ist nur mit einem Shared Secret (API Key) möglich, der vom Administrator festgelegt werden muss.\\
Für den Zugriff auf die API existieren bereits Java-Bibliotheken, die alle API-Funktionen auf Methoden einer Java-Klasse abbilden.
Für das Projekt EtherApp kam dabei die Implementation\citeque{hollinger} des US-amerikanischen Entwicklers Jordan Hollinger zum Einsatz.\\
Die Bibliothek beinhaltet eine Klasse \texttt{EPLiteClient}, die mit den Zugangsdaten für die EPL-API initialisiert wird.
Mit einem Objekt dieser Client-Klasse können Anfragen auf die jeweilige API durchgeführt werden, die als Java-Datenstruktur (\texttt{String} oder \texttt{HashMap}) zurückgegeben werden.

\subsection{Selbst definierte Listen}
Das Android-SDK stellt mit dem \texttt{ListView} ein View-Element zur Verfügung, mit dem Elemente in einer scrollbaren Liste angezeigt werden können.\\
Zur Anpassung von Daten und das tatsächliche Darstellen in der Liste wird ein Adapter benötigt.
Android stellt bereits eine Reihe von Adaptern zur Verfügung (\texttt{BaseAdapter}, \texttt{ArrayAdapter}, ...).
Deren Nachteil ist jedoch eine festgelegte Darstellungsweise; es ist auf einem Listenelement lediglich ein \texttt{TextView} dargestellt.\\
In unserem Anwendungsfall sollten in den Listenelementen der Padliste neben dem eigentlichen Pad-Namen zusätzliche Statusinformationen zum Pad sowie ein Löschen-Button angezeigt werden.
Dieses Ziel konnte nur mit einem eigenen Adapter\footnote{\texttt{de.etherapp.adapters.PadlistBaseAdapter.java}} und einem selbst gestalteten Listenelement\footnote{\texttt{de.etherapp.beans.PadlistItem.java}} erreicht werden.\\


\subsection{Asynchrones Laden der Listenelemente}
Um eine komplette Padliste inklusive der Metadaten zu jedem Pad abzurufen, sind folgende Anfragen an die HTTP-API nötig:
\begin{itemize}
	\item Abrufen der Padliste (nur IDs)
	\item Abrufen der Metadaten zu jedem einzelnen Pad
		\begin{itemize}
			\item Anzahl der User online
			\item Anzahl der Revisionen
			\item Datum der letzten Bearbeitung
		\end{itemize}
\end{itemize}

Für jedes Pad sind also drei HTTP-Anfragen abzusetzen.
Bei einem Volumen von 300 Pads sind damit 901 HTTP-Anfragen nötig, um alle Daten der Padliste abzurufen, auch wenn der Benutzer diese zunächst gar nicht benötigt! Neben der dadurch ausgelösten Serverlast ist auch die resultierende Wartezeit für den Benutzer nicht akzeptabel.
Dieser Umstand erfordert eine Lösung, mit der die Inhalte eines Listenelements erst dann geladen werden, wenn das Element auch angezeigt wird.
Dieses Ziel kann mit einem \texttt{AsyncTask} erreicht werden.
Zunächst wird synchron die Liste aller Pads abgerufen und das \texttt{ListView} mit Elementen gefüllt. Jedes angezeigte Listenelement startet einen neuen Thread für jeden zu ladenden Wert.
Der Thread stellt asynchron die Anfragen an die API und schreibt die Ergebnisse direkt in die Views des Listenelements..
Das asynchrone Laden ist beim Scrollen der Liste an der Zeitverzögerung zu erkennen.

